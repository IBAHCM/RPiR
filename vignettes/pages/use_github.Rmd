---
title: "Version control with GitHub and RStudio"
date: '`r format(Sys.Date(), "%B %d %Y")`'
output:
  rmarkdown::html_vignette:
  toc: true
  toc_depth: 2
  vignette: >
    %\VignetteIndexEntry{github}
    %\VignetteEngine{knitr::knitr}
    %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Version control

*with GitHub and RStudio*

## Create a new GitHub repository

It's important that you use version control in your project workflow, so let's 
**set up a new GitHub repository** (you should make a new repository for each
project you're working on). To do this, go to the 
[IBAHCM](http://www.github.com/IBAHCM) organisation on GitHub, then click on 
click <span style="color: #de77ae;">New</span>.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/01.png')
```


You should always choose a short, descriptive name for your repository. But in
this case, to make it easier for us to identify you, please name your repository
`githubusername_0201` (where 0201 corresponds to the first part of Practical 
series 2). Make sure you're creating a 
<span style="color: #de77ae;">Private</span> repository, check the box to
<span style="color: #de77ae;">Initialize this repository with a README</span>,
then select <span style="color: #de77ae;">Create repository</span>. 

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/02.png')
```

> Note that in Practical series 3 you'll be writing a package... and when doing 
so it's good practice for the name of your repository to match the name of
your package. It's important to be aware that the name of a package 
"should contain only (ASCII) letters, numbers and dot, have at least two 
characters and start with a letter and not end in a dot"
([ref](https://cran.r-project.org/doc/manuals/R-exts.html)). Though very few
[package](https://cran.r-project.org/web/packages/available_packages_by_name.html)
names include a dot.

Since we're not working with packages just yet, including an underscore in the 
name of a repository is perfectly fine. Your GitHub repo should now contain a 
single `README.md` file look a bit like this:

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/03.png')
```

Now click on the green <span style="color: #de77ae;">Code</span> button and 
**copy the URL** associated with your GitHub repository to your clipboard

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/04.png')
```

## Create a new RStudio project

In RStudio, click <span style="color: #de77ae;">File > New project...</span>, 
then since we're integrating version control into this project workflow, you 
should select <span style="color: #de77ae;">Version Control</span>.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/05.png')
```

Select the option to clone a project from a 
<span style="color: #de77ae;">Git</span> repository.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/06.png')
```

**Paste your Repository URL** into the first box, then click 
<span style="color: #de77ae;">Browse...</span> 
and navigate to the git folder on your desktop. If you don't have a git folder 
on your desktop then make one, as it's good practice to keep all of your 
projects together and well organised. RStudio will create a new subdirectory 
that will mirror the contents of your Git repository (so make sure you 
don't already have a folder with the same name as the repository you created, 
as this will cause problems). Now click 
<span style="color: #de77ae;">Create Project</span> and enter your GitHub 
username and password if you're asked.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/07.png')
```

Congratulations! You have successfully created a new RStudio project (now with
added version control). In the example below, (1) the RStudio project is called 
`soniamitchell_0201`, (2) a new directory, `soniamitchell_0201`, has been 
created, which is now your working directory, and inside this directory are (3) 
three files, including a GitHub `README.md` file (imported from your GitHub 
repository), an RStudio project file (`soniamitchell_0201.Rproj`), and an 
invisible `.gitignore` file (created by RStudio). 

Note the appearance of a new <span style="color: #de77ae;">Git</span> tab next 
to <span style="color: #de77ae;">Connections</span>. This is 
important.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/08.png')
```

## Using git in RStudio

Compare the contents of your working directory to the files listed in the
<span style="color: #de77ae;">Git</span> tab. The 
<span style="color: #de77ae;">Git</span> tab is a useful tool that shows you 
how your remote
directory (your GitHub repository) differs from your local directory 
(in this case `~Desktop/Git/test`). Currently, the `README.md` file in your 
local directory is identical to the one in your remote directory. That's why 
you can't see it in the <span style="color: #de77ae;">Git</span> tab. Instead,
`.gitignore` and `test.Rproj` are listed with yellow question marks in the 
<span style="color: #de77ae;">Status</span> column. What do these icons mean?

* "?" - Files or directories that don't currently exist in your git repository 
(you either want to commit these or add them to `.gitignore`)
* "A" - Files that have been staged and are ready to commit (you're in the 
process of committing these)
* "M" - Files that are modified versions of those in the repository (you 
definately want to commit these)
* "D" - Files that are no longer in your local directory (you've likely deleted
these and want to commit their absence to GitHub)

Open the `README.md` file by clicking on its filename in the 
<span style="color: #de77ae;">Files</span> tab. 
Does this look familiar? (Compare the contents of this file to your
repository on GitHub)

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/09.png')
```

Usually a GitHub README (written in [GitHub Flavored Markdown](https://help.github.com/en/github/writing-on-github)) will describe the 
contents of the GitHub repository or give an example of how to use the contents 
of said repository. Make some edits to `README.md` and **save your file**. Note 
that when we make edits to the README file, its 
<span style="color: #de77ae;">Status</span> changes to "M". This 
means that the file in your local directory is no longer identical to the file 
in your remote directory (on GitHub). Check the box next to the file you want 
to commit (`README.md`), then click <span style="color: #de77ae;">Commit</span>.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/10.png')
```

The <span style="color: #de77ae;">RStudio: Review Changes</span> window has 
opened. Make sure the checkbox is ticked next to `README.md` and enter a 
<span style="color: #de77ae;">Commit message</span>. Your message 
should describe the changes you've made to the file you're uploading. These 
changes are shown in the lower half of the 
screen, with deletions and insertions highlighted in red and green, 
respectively. Click <span style="color: #de77ae;">Commit</span> to stage your 
changes (preparing to upload to GitHub).

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/11.png')
```

Congratulations! `README.md` is now staged, with 5 insertions. 
**Close** the <span style="color: #de77ae;">RStudio: Review Changes</span> window.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/12.png')
```

Notice that `README.md` has disappeared from the 
<span style="color: #de77ae;">Git</span> tab? That's because it's packaged up 
(staged) and ready to be shipped out (pushed) to GitHub.
Click on the green <span style="color: #de77ae;">Push</span> arrow, to push 
all staged files (at the moment, just `README.md`) to GitHub. Enter your 
password if you're asked for it.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/13.png')
```

Congratulations again! You've successfully pushed these changes to GitHub. Go
take a look at your GitHub repository and you'll see that the GitHub README 
has been updated. 

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/14.png')
```

## Tasks

Back in RStudio.. load the `RPiR` package and run the `practical_series_one()` 
function. This will populate your working directory -- and therefore your 
RStudio project -- with the scripts and functions from Practical series 1. 
Remember that the question mark in the 
<span style="color: #de77ae;">Status</span> column of the 
<span style="color: #de77ae;">Git</span> tab means that these are not currently 
in your GitHub repository.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/a.png')
```

So let's push them up to GitHub! Check the boxes next to all of the files, the
scripts, the functions, and invisible `.gitignore` file and even the RStudio
project file. Then click <span style="color: #de77ae;">Commit</span>.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/b.png')
```

Write a suitably descriptive message and 
<span style="color: #de77ae;">Commit</span> the files.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/c.png')
```

Alot has happened this time.. 11 files changed and 513 insertions.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/d.png')
```

Now go to your GitHub repository. Are the files there? What did we forget to 
do? Don't forget that pressing <span style="color: #de77ae;">Commit</span> 
isn't enough. When you commit your files, you're packaging them up ready to go. 
You still have to <span style="color: #de77ae;">Push</span> them to GitHub. Do
that now and make sure they appear in your repository.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/e.png')
```

## Sharing is caring

Now we're going to try and share our work. To make it a little more interesting,
edit your `README.md` file. Write a sentence or two about yourself and what you
hope to get out of this course. Commit your changes and push them to GitHub.
Then look at your GitHub repository and make sure you can see your changes. 

To share your work, since you created a private (rather than a public) 
repository, you need to give people permission to see it. So, click on 
<span style="color: #de77ae;">Settings</span>, 
<span style="color: #de77ae;">Manage access</span>, then 
<span style="color: #de77ae;">Invite teams or people</span>.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/f.png')
```

Find the `IBAHCM/rpir` team (that's you guys).

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/g.png')
```

Make sure <span style="color: #de77ae;">Read</span> access is selected and
<span style="color: #de77ae;">Add IBAHCM/rpir to this repository</span>.

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/h.png')
```

It should look like this:

```{r echo = FALSE, fig.align = "center", out.width = "100%"}
knitr::include_graphics('use_github/i.png')
```

Now, exchange repository names with your group (everyone in your breakout room).
You should have access if you're part of the `IBAHCM/rpir` team. 

## Final remarks

RStudio offers integrated version control, which is useful for **daily tasks**
such as pushing, pulling, and reviewing changes (click on 
<span style="color: #de77ae;">Diff</span> in the 
<span style="color: #de77ae;">Git</span> tab). However, this is just the tip of 
the iceberg. If you have time, 
why not take a look at the links below.

## Additional resources

* [R packages - Git and GitHub, by Hadley Wickham](http://r-pkgs.had.co.nz/git.html)
* [Pro Git, by Scott Chacon and Ben Straub ](https://git-scm.com/book/en/v2)
* [git/github guide, by Karl Broman](https://kbroman.org/github_tutorial/)
* [git - the simple guide, by Roger Dudler](https://rogerdudler.github.io/git-guide/)
